{% extends 'base.html' %}

{% block title %}My Wishlist{% endblock %}

{% block content %}
<div class="wishlist-section">
    <h1>My Wishlist</h1>
    
    {% if plates %}
        <div class="plates-grid">
            {% for plate in plates %}
            <div class="plate-card">
                {% if plate.image_path %}
                    <div class="plate-image">
                        <img src="{{ plate.image_path }}" alt="License Plate {{ plate.plateNumber }}{{ plate.plateLetter }}">
                    </div>
                {% endif %}
                <div class="plate-number">{{ plate.plateNumber }}{{ plate.plateLetter }}</div>
                <p class="price">{{ "%.2f"|format(plate.price) }} SAR</p>
                {% if plate.description %}
                    <p class="description">{{ plate.description }}</p>
                {% endif %}
                <div class="plate-actions">
                    <button class="remove-from-wishlist" data-plate-id="{{ plate.plateID }}">Remove from Wishlist</button>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <p>Your wishlist is empty.</p>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const removeButtons = document.querySelectorAll('.remove-from-wishlist');
    
    removeButtons.forEach(button => {
        button.addEventListener('click', async function() {
            const plateId = this.dataset.plateId;
            try {
                const response = await fetch(`/wishlist/remove/${plateId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    // Remove the plate card from the DOM
                    this.closest('.plate-card').remove();
                    
                    // If no plates left, show empty message
                    const platesGrid = document.querySelector('.plates-grid');
                    if (platesGrid && platesGrid.children.length === 0) {
                        platesGrid.innerHTML = '<p>Your wishlist is empty.</p>';
                    }
                } else {
                    alert('Failed to remove from wishlist');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to remove from wishlist');
            }
        });
    });
});
</script>
{% endblock %} 